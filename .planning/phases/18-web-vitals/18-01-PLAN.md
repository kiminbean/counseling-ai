---
phase: 18-web-vitals
plan: 01
type: execute
depends_on: ["17-01"]
files_modified: [lib/webVitals.ts, app/layout.tsx, lib/analytics.ts]
---

<objective>
Web Vitals 수집 및 GA4/콘솔 리포팅 구현

Purpose: Core Web Vitals 모니터링으로 사용자 경험 성능 측정
Output: web-vitals 라이브러리 통합, LCP/FID/CLS 메트릭 수집 및 리포팅
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-analytics-setup/17-01-SUMMARY.md
@lib/analytics.ts

**Tech stack:** Next.js 14 App Router, TypeScript
**Prior work:** Phase 17에서 GA4 analytics.ts 생성됨
**Constraining decisions:**
- web-vitals 라이브러리 사용 (Google 공식)
- GA4 event로 전송 또는 콘솔 로깅
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install web-vitals package</name>
  <files>package.json</files>
  <action>
web-vitals 패키지 설치:
npm install web-vitals

이 라이브러리는 Core Web Vitals를 측정하는 Google 공식 라이브러리입니다.
  </action>
  <verify>npm ls web-vitals</verify>
  <done>web-vitals 패키지 설치됨</done>
</task>

<task type="auto">
  <name>Task 2: Create Web Vitals utility</name>
  <files>lib/webVitals.ts</files>
  <action>
Web Vitals 수집 유틸리티 생성:
- web-vitals의 onCLS, onFID, onFCP, onLCP, onTTFB 사용
- reportWebVitals(metric) 함수: 메트릭 처리
- sendToAnalytics(metric) 함수: GA4로 전송 (analytics.ts의 event 사용)
- 개발 환경에서는 콘솔에 포맷팅된 출력
- 메트릭 값에 따른 품질 판정 (good/needs-improvement/poor)

Core Web Vitals 임계값:
- LCP: good < 2.5s, poor > 4s
- FID: good < 100ms, poor > 300ms
- CLS: good < 0.1, poor > 0.25

주의: 클라이언트 전용 코드, 'use client' 또는 동적 import 필요
  </action>
  <verify>TypeScript 컴파일 오류 없음</verify>
  <done>webVitals.ts 생성됨, 5개 메트릭 수집 함수 정의됨</done>
</task>

<task type="auto">
  <name>Task 3: Integrate Web Vitals reporting</name>
  <files>app/layout.tsx, components/providers/Providers.tsx</files>
  <action>
Web Vitals 리포팅 통합:
- WebVitalsReporter 컴포넌트 생성 (클라이언트 컴포넌트)
- useEffect에서 web-vitals 함수 호출
- layout.tsx 또는 Providers에 추가

Next.js App Router에서의 접근:
- next/third-parties의 GoogleAnalytics는 자동으로 Web Vitals 전송
- 또는 수동으로 WebVitalsReporter 컴포넌트 사용

수동 방식 선택 시:
```tsx
'use client';
import { useEffect } from 'react';
import { reportWebVitals } from '@/lib/webVitals';

export function WebVitalsReporter() {
  useEffect(() => {
    reportWebVitals();
  }, []);
  return null;
}
```
  </action>
  <verify>브라우저 콘솔에서 Web Vitals 로그 확인</verify>
  <done>Web Vitals 리포팅 동작, 콘솔/GA4에 메트릭 전송됨</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` 오류 없음
- [ ] 개발 서버에서 Web Vitals 콘솔 출력 확인
- [ ] LCP, FID, CLS 메트릭 수집됨
- [ ] GA 활성화 시 이벤트로 전송됨
</verification>

<success_criteria>
- web-vitals 패키지 설치됨
- lib/webVitals.ts 생성됨
- Core Web Vitals 5개 메트릭 수집
- 콘솔 또는 GA4로 리포팅 동작
</success_criteria>

<output>
After completion, create `.planning/phases/18-web-vitals/18-01-SUMMARY.md`
</output>
