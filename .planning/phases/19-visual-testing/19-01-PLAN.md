---
phase: 19-visual-testing
plan: 01
type: execute
depends_on: []
files_modified: [playwright.config.ts, e2e/visual.spec.ts, package.json]
---

<objective>
Playwright 기반 Visual Regression 테스트 구현

Purpose: UI 변경 사항의 시각적 회귀 감지로 디자인 일관성 보장
Output: Playwright 스크린샷 비교 테스트, 주요 페이지 시각적 스냅샷
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@playwright.config.ts
@e2e/navigation.spec.ts

**Tech stack:** Playwright (이미 설치됨), Next.js 14
**Prior work:** Phase 16에서 Playwright E2E 테스트 56개 구현
**Constraining decisions:**
- 기존 Playwright 설정 확장
- Percy/Chromatic 대신 Playwright 내장 스크린샷 비교 사용 (무료, 간단)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Playwright for visual testing</name>
  <files>playwright.config.ts</files>
  <action>
Playwright 설정에 visual 테스트 옵션 추가:
- expect.toHaveScreenshot() 기본 설정
- snapshotDir: 스냅샷 저장 경로 설정
- threshold: 픽셀 차이 허용 임계값 (0.1 - 10% 차이 허용)
- maxDiffPixels 또는 maxDiffPixelRatio 설정

설정 예시:
```typescript
expect: {
  toHaveScreenshot: {
    maxDiffPixelRatio: 0.1,
    animations: 'disabled',
    caret: 'hide',
  },
},
```

주의: 애니메이션 비활성화로 일관된 스크린샷 확보
  </action>
  <verify>playwright.config.ts 문법 오류 없음</verify>
  <done>Visual 테스트 설정 추가됨, threshold 설정됨</done>
</task>

<task type="auto">
  <name>Task 2: Create visual regression test suite</name>
  <files>e2e/visual.spec.ts</files>
  <action>
주요 페이지 시각적 테스트 생성:
- 홈페이지 (채팅 화면) 스크린샷
- 설정 페이지 스크린샷
- 도움말 페이지 스크린샷
- 개인정보 페이지 스크린샷
- 모바일 뷰포트 테스트 (Pixel 5 크기)
- 다크 모드 테스트

테스트 구조:
```typescript
test.describe('Visual Regression Tests', () => {
  test('homepage matches screenshot', async ({ page }) => {
    await page.goto('/');
    await page.waitForLoadState('networkidle');
    await expect(page).toHaveScreenshot('homepage.png');
  });
});
```

주의:
- 동적 콘텐츠(시간, 랜덤 ID) 마스킹
- 네트워크 idle 상태 대기
- 첫 실행 시 기준 스냅샷 생성됨
  </action>
  <verify>npm run test:e2e -- visual.spec.ts --update-snapshots (첫 실행)</verify>
  <done>visual.spec.ts 생성됨, 주요 페이지 스크린샷 테스트 포함</done>
</task>

<task type="auto">
  <name>Task 3: Add visual test npm script</name>
  <files>package.json</files>
  <action>
Visual 테스트 전용 npm 스크립트 추가:
- "test:visual": "playwright test visual.spec.ts"
- "test:visual:update": "playwright test visual.spec.ts --update-snapshots"

.gitignore에 테스트 결과 제외 (이미 있을 수 있음):
- test-results/
- playwright-report/

스냅샷 파일은 git에 포함 (e2e/*.spec.ts-snapshots/)
  </action>
  <verify>npm run test:visual 실행 가능</verify>
  <done>npm script 추가됨, visual 테스트 실행 가능</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run test:visual` 실행됨
- [ ] 기준 스크린샷 생성됨 (e2e/*.spec.ts-snapshots/)
- [ ] 재실행 시 스크린샷 비교 동작
- [ ] 모바일/데스크톱 뷰포트 테스트됨
</verification>

<success_criteria>
- playwright.config.ts에 visual 설정 추가됨
- e2e/visual.spec.ts 생성됨
- 최소 4개 페이지 시각적 테스트
- 기준 스냅샷 생성 및 비교 동작
</success_criteria>

<output>
After completion, create `.planning/phases/19-visual-testing/19-01-SUMMARY.md`
</output>
